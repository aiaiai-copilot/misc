# MISC (MindSection) - Product Requirements Document

## 1. Обзор продукта

### 1.1 Описание

MISC - минималистичная система управления информацией, основанная на единственном принципе: всё есть теги. Каждая запись представляет собой набор слов (тегов), разделённых пробелами. Система устраняет барьер между мыслью и записью, предлагая мгновенную фиксацию и поиск информации без традиционных структур организации данных.

### 1.2 Ключевые принципы продукта

- **Радикальная простота**: Один механизм для всех типов информации
- **Нулевой порог входа**: Не требует обучения
- **Скорость в приоритете**: Мгновенная фиксация мысли
- **Прозрачность**: Пользователь всегда понимает, как работает система

### 1.3 Архитектурные принципы

- **Clean Architecture**: Независимость бизнес-логики от деталей реализации
- **Domain-First**: Доменная модель разрабатывается первой и не зависит от UI или БД
- **Test-Driven Development**: Разработка через тестирование с первого дня
- **Dependency Inversion**: Зависимости направлены к центру (к домену)
- **SOLID принципы**: Каждый компонент имеет единственную ответственность

### 1.4 Целевые метрики

- Время до первой записи: < 10 секунд
- Время на обучение: < 1 минута
- Универсальность использования: 80% пользователей для 3+ типов информации
- Retention: 60% активных пользователей через месяц
- **Покрытие тестами**: 
  - Доменный слой: > 95%
  - Use Cases: > 90%
  - Общее покрытие: > 80%

## 2. Функциональные требования

### 2.1 Core функциональность

#### 2.1.1 Управление записями

- **Создание записи**: Ввод набора тегов через пробел
- **Поиск записей**: Поиск по любой комбинации тегов (логика AND)
- **Редактирование записи**: Полная замена содержимого записи
- **Удаление записи**: Безвозвратное удаление
- **Уникальность записи**: Запись = уникальное множество тегов (порядок не важен для идентификации)
- **Сохранение порядка тегов**: При отображении записи теги показываются в том порядке, в котором их ввёл пользователь

#### 2.1.2 Работа с тегами

- **Определение тега**: Любая последовательность символов без пробелов
- **Ограничения тегов**: 
  - Запрещены служебные символы JSON: `{}[]:,"\`
  - Поддержка всех остальных Unicode символов
  - Автоматическое приведение к нижнему регистру (настраиваемо)
  - Опциональное удаление диакритических знаков (настраиваемо)
- **Нормализация тегов**:
  - Приведение к нижнему регистру для поиска
  - Удаление диакритики (é→e, ñ→n) для улучшения поиска (опционально)
  - Пример: "Café" и "cafe" найдутся по одному запросу
- **Автодополнение**: Подсказки на основе существующих тегов
- **Статистика использования**: Подсчёт частоты использования тегов
- **Порядок тегов в записи**: 
  - Порядок ввода тегов сохраняется для каждой записи
  - При редактировании пользователь может изменить порядок тегов
  - Порядок важен для читаемости, но не влияет на уникальность записи

#### 2.1.3 Интерфейс поиска

- **Инкрементальный поиск**: Результаты обновляются при вводе
- **Облако тегов**: Отображается когда результаты не помещаются на экран
  - Размер тега пропорционален частоте использования
  - Клик по тегу добавляет его к поисковому запросу
- **Список записей**: Отображается когда результаты помещаются на экран
  - Сортировка по дате создания (новые сверху)
  - Отображение полного содержимого записи (по возможности)

### 2.2 Пользовательский интерфейс

#### 2.2.1 Основной интерфейс

- **Единое поле ввода**: Универсальное поле для поиска и создания записей
- **Адаптивное отображение**: 
  - Режим поиска по умолчанию
  - Предложение создать запись при отсутствии результатов
- **Минималистичный дизайн**: Фокус на содержимом, минимум визуальных элементов
- **Индикаторы состояния**:
  - Поиск: Визуальная индикация во время debounce задержки (например, троеточие или spinner)
  - Загрузка: Индикатор при выполнении операций

#### 2.2.2 Управление клавиатурой

- **Enter**: Сохранить новую запись / Открыть выбранную для редактирования
- **Escape**: Очистить поле ввода
- **Tab**: Автодополнение тега
- **↑/↓**: Навигация по результатам поиска
- **Delete**: Удалить выбранную запись

### 2.3 Экспорт/Импорт

#### 2.3.1 Функциональность

- **Экспорт всех данных**: В JSON формате с версионированием
- **Импорт данных**: Полная замена существующих данных (очистка + загрузка)
- **Версионирование формата**: Для обеспечения совместимости
- **Простота формата**: Только пользовательские данные, без внутренних идентификаторов

#### 2.3.2 Формат данных

```json
{
  "version": "1.0",
  "records": [
    {
      "content": "ToDo встреча Петров 15:00",
      "createdAt": "2024-01-01T10:00:00Z",
      "updatedAt": "2024-01-01T10:00:00Z"
    }
  ],
  "metadata": {
    "exportedAt": "2024-01-15T12:00:00Z",
    "recordCount": 42,
    "normalizationRules": {
      "caseSensitive": false,
      "removeAccents": true
    }
  }
}
```

#### 2.3.3 Интерфейс

- **Доступ**: Через меню настроек
- **Прогресс**: Отображение процесса импорта/экспорта
- **Обработка ошибок**: Информативные сообщения об ошибках
- **Предупреждение при импорте**: Уведомление о полной замене данных

## 3. Нефункциональные требования

### 3.1 Производительность

- **Время отклика поиска**: < 100мс для 10,000 записей
- **Время сохранения**: < 50мс
- **Размер приложения**: < 500KB (gzipped)
- **Запуск приложения**: < 2 секунды

### 3.2 Надёжность

- **Сохранение данных**: Автоматическое сохранение без потери данных
- **Валидация**: Проверка корректности на всех уровнях
- **Обработка ошибок**: Graceful degradation, информативные сообщения
- **Восстановление**: Возможность восстановления из экспортированных данных

### 3.3 Юзабилити

- **Отзывчивый дизайн**: Адаптация под разные размеры экранов
- **Доступность**: Поддержка keyboard-only навигации
- **Обратная связь**: Визуальные индикаторы состояний
- **Время отклика UI**: < 16мс для плавности анимаций

### 3.4 Тестируемость

- **Модульное тестирование**: Все компоненты должны быть тестируемы изолированно
- **Интеграционное тестирование**: Тесты взаимодействия между слоями
- **E2E тестирование**: Основные пользовательские сценарии
- **Тестовые данные**: Возможность генерации и загрузки тестовых данных

### 3.5 Модульность и расширяемость

- **Независимость слоёв**: Изменения в одном слое не должны требовать изменений в других
- **Подключаемые хранилища**: Возможность смены localStorage на другие хранилища
- **Расширяемость функций**: Новые функции добавляются без изменения существующего кода
- **Конфигурируемость**: Настройки вынесены в конфигурацию

## 4. Технические ограничения

### 4.1 Архитектурные ограничения

- **Чистая архитектура**: Строгое разделение на слои (Domain, Application, Infrastructure, Presentation)
- **Инверсия зависимостей**: Внешние слои зависят от внутренних, но не наоборот
- **Иммутабельность**: Доменные объекты иммутабельны
- **Чистые функции**: Бизнес-логика реализована через чистые функции где возможно
- **Переиспользуемые компоненты**: UI компоненты должны быть адаптируемы для web и CLI версий

### 4.2 Технологический стек

- **Монорепозиторий**: yarn workspaces для управления пакетами
- **Язык**: TypeScript для всех слоёв
- **Frontend фреймворк**: React (детали презентационного слоя)
- **CLI фреймворк**: Ink (React для терминала)
- **Сборщик**: Vite для web, esbuild для CLI
- **Тестирование**: Jest/Vitest для unit-тестов, Testing Library для компонентов

### 4.3 Совместимость

- **Браузеры**: Последние 2 версии Chrome, Firefox, Safari, Edge
- **Минимальное разрешение**: 320px ширина
- **JavaScript**: ES2020+ с транспиляцией

## 5. Настройки пользователя

### 5.1 Базовые настройки

- **Регистрозависимость тегов**: Вкл/Выкл (по умолчанию: выкл)
- **Удаление диакритики**: Вкл/Выкл (по умолчанию: вкл)
- **Живой поиск**: Вкл/Выкл (по умолчанию: вкл)
- **Язык интерфейса**: Автоопределение с возможностью изменения

### 5.2 Ограничения

- **Максимальная длина тега**: Настраиваемая (по умолчанию: 100 символов)
- **Максимальное количество тегов в записи**: Настраиваемое (по умолчанию: 50)
- **Максимальный размер хранилища**: Предупреждение при приближении к лимиту

## 6. Этапы разработки

### 6.1 Этап 0: Инфраструктура и архитектура

- [ ] Настройка монорепозитория с yarn workspaces
- [ ] Настройка TypeScript конфигурации для всех пакетов
- [ ] Настройка тестовой инфраструктуры (Jest/Vitest)
- [ ] Настройка линтеров и форматтеров
- [ ] Создание базовой структуры слоёв Clean Architecture
- [ ] Настройка CI/CD pipeline для тестов

### 6.2 Этап 1: Доменный слой (Domain Layer)

- [ ] Разработка доменных сущностей через TDD
- [ ] Создание value objects с валидацией
- [ ] Реализация сохранения порядка тегов в записях
- [ ] Реализация доменных сервисов (включая нормализацию с диакритикой)
- [ ] Определение доменных событий
- [ ] Создание спецификаций для валидации
- [ ] 95%+ покрытие тестами

### 6.3 Этап 2: Прикладной слой (Application Layer)

- [ ] Реализация use cases через TDD
- [ ] Создание DTO для взаимодействия между слоями
- [ ] Определение портов (интерфейсов репозиториев)
- [ ] Реализация прикладных сервисов
- [ ] 90%+ покрытие тестами

### 6.4 Этап 3: Инфраструктурный слой - Прототип

- [ ] Реализация репозиториев с localStorage
- [ ] Создание адаптеров для внешних сервисов
- [ ] Реализация персистентности данных
- [ ] Версионирование формата данных
- [ ] Интеграционные тесты

### 6.5 Этап 4: Презентационный слой

- [ ] Базовые React компоненты
- [ ] Реализация основного UI (единое поле ввода)
- [ ] Отображение результатов поиска
- [ ] Облако тегов и список записей
- [ ] Клавиатурная навигация
- [ ] Компонентные тесты

### 6.6 Этап 5: Расширенная функциональность

- [ ] Автодополнение тегов
- [ ] Экспорт/импорт данных с версионированием
- [ ] Настройки пользователя (включая нормализацию)
- [ ] Оптимизация производительности
- [ ] E2E тесты основных сценариев

### 6.7 Этап 6: CLI версия

- [ ] CLI приложение на Ink
- [ ] Переиспользование domain и application слоёв
- [ ] Адаптация UI компонентов для терминала
- [ ] Быстрое добавление записей из командной строки
- [ ] Интеграция с shell (автодополнение, aliases)

### 6.8 Этап 7: MVP с Backend

- [ ] Миграция на PostgreSQL
- [ ] REST API / GraphQL
- [ ] Авторизация и аутентификация
- [ ] Синхронизация данных
- [ ] Многопользовательность

## 7. Пользовательские сценарии

### 7.1 Первое использование

1. Пользователь открывает приложение
2. Видит пустое поле ввода с плейсхолдером
3. Начинает вводить теги через пробел
4. Нажимает Enter - запись сохранена
5. Поле очищается, готово для новой записи

### 7.2 Поиск информации

1. Пользователь вводит один или несколько тегов
2. Видит результаты в реальном времени
3. Если много результатов - видит облако тегов
4. Кликает по тегу в облаке для уточнения
5. Находит нужную запись

### 7.3 Редактирование записи

1. Пользователь находит запись через поиск
2. Кликает по записи или выбирает стрелками + Enter
3. Запись загружается в поле ввода с сохранением исходного порядка тегов
4. Редактирует содержимое
5. Нажимает Enter - изменения сохранены

### 7.4 Экспорт/Импорт данных

1. **Экспорт**: Пользователь нажимает "Экспорт" → получает JSON файл со всеми записями
2. **Импорт**: 
   - Пользователь выбирает JSON файл
   - Видит предупреждение о полной замене данных
   - Подтверждает → все старые данные удаляются
   - Новые данные загружаются из файла
   - Теги автоматически создаются на основе content

## 8. Критерии приёмки

### 8.1 Функциональные критерии

- Все основные use cases работают согласно спецификации
- Данные сохраняются и восстанавливаются корректно
- Поиск находит все релевантные записи
- Экспорт/импорт работает без потери данных
- Горячие клавиши работают как описано
- Нормализация с диакритикой работает корректно

### 8.2 Архитектурные критерии

- Доменный слой не имеет зависимостей от других слоёв
- Use cases тестируются без UI и БД
- Репозитории легко заменяются (localStorage → PostgreSQL)
- Новые функции добавляются без изменения существующего кода
- Все слои имеют чёткие границы и интерфейсы

### 8.3 Качественные критерии

- Покрытие тестами соответствует целевым метрикам
- Производительность соответствует требованиям
- Код соответствует принципам SOLID
- Документация покрывает все публичные API
- Отсутствуют критические и высокие баги

## 9. Риски и ограничения

### 9.1 Технические риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Сложность Clean Architecture для простого прототипа | Средняя | Среднее | Поэтапная реализация, начиная с домена |
| Производительность при большом количестве записей | Низкая | Высокое | Индексация, пагинация, виртуализация списков |
| localStorage лимиты | Средняя | Среднее | Мониторинг использования, предупреждения |
| Проблемы с нормализацией диакритики | Низкая | Низкое | Тестирование с разными языками, настройки |

### 9.2 Продуктовые риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| "Слишком просто" для пользователей | Средняя | Высокое | Обучающие материалы, примеры использования |
| Путаница с концепцией "всё есть теги" | Средняя | Среднее | Интуитивный UI, onboarding |
| Дублирование записей из-за опечаток | Высокая | Низкое | Агрессивное автодополнение, fuzzy search в будущем |

## 10. Ограничения прототипа

- **Объём данных**: До 5-10MB (localStorage ограничения)
- **Многопользовательность**: Отсутствует
- **Синхронизация**: Отсутствует
- **Резервное копирование**: Только через ручной экспорт
- **Fuzzy поиск**: Отсутствует (точное совпадение тегов)
- **История изменений**: Отсутствует
- **Совместная работа**: Отсутствует

## 11. Метрики успеха

### 11.1 Технические метрики

- Покрытие тестами: > 80% общее, > 95% домен
- Время сборки: < 30 секунд
- Размер бандла: < 500KB gzipped
- Производительность: 60 FPS при всех интеракциях
- Нулевые критические баги в продакшене

### 11.2 Продуктовые метрики

- Время до продуктивного использования: < 1 минуты
- NPS: > 50 после месяца использования
- Daily Active Users: > 100 для валидации
- Количество записей на пользователя: > 50 в первый месяц
- Разнообразие use cases: 3+ типа информации на пользователя

### 11.3 Метрики качества кода

- Цикломатическая сложность: < 10 для всех функций
- Дублирование кода: < 3%
- Техдолг (по SonarQube): < 5 дней
- Время review PR: < 24 часов
- Среднее время исправления бага: < 48 часов